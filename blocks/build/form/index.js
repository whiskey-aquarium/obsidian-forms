(()=>{"use strict";var e,o={258:(e,o,i)=>{const t=window.wp.blocks,s=window.wp.apiFetch;var r=i.n(s);const n=window.wp.components,a=window.wp.element,l=window.wp.i18n,d=window.wp.notices,c=window.wp.blockEditor,f=window.wp.coreData,m=()=>{var e;return null!==(e=window.obsidianForms?.settings?.defaults)&&void 0!==e?e:{}},p=window.ReactJSXRuntime,b=e=>{const{formSettings:o,handleSettingChange:i}=e,t=null!==(s=window.obsidianForms?.settings?.metadata)&&void 0!==s?s:{};var s;return(0,p.jsx)(p.Fragment,{children:o&&Object.entries(o).map((([e,o])=>{const s=t[e];return s?"select"===s.type?(0,p.jsx)(n.SelectControl,{label:s.label,value:o,options:s.options,onChange:o=>i(e,o)},e):"radio"===s.type?(0,p.jsx)(n.RadioControl,{label:s.label,selected:o,options:s.options,onChange:o=>i(e,o)},e):"toggle"===s.type?(0,p.jsx)(n.ToggleControl,{label:s.label,checked:o,onChange:o=>i(e,o)},e):(0,p.jsx)(n.TextControl,{label:s.label,value:o,onChange:o=>i(e,o)},e):null}))})},u=JSON.parse('{"$schema":"https://schemas.wp.org/trunk/block.json","apiVersion":3,"name":"obsidian-form/form","version":"0.1.0","title":"Obsidian Form","category":"widgets","icon":"feedback","description":"An Obsidian Form block.","supports":{"html":false,"align":true,"color":{"background":true,"text":true},"anchor":true},"attributes":{"anchor":{"type":"string","default":""},"formPostId":{"type":"number","default":0}},"providesContext":{"obsidian-form/formSettings":"formSettings"},"editorScript":["file:./index.js","obsidian-forms-settings"],"editorStyle":"file:./index.css","script":"file:./view.js","style":"file:./style-index.css","allowedBlocks":["obsidian-form/field-group"],"usesContext":[],"render":"file:./index.php"}');(0,t.registerBlockType)(u.name,{...u,edit:function(e){const{attributes:o,setAttributes:i}=e,{formPostId:t,formSettings:s}=o,[u,h]=(0,a.useState)(!1),[g,_]=(0,a.useState)(""),[w,v]=(0,a.useState)(null),[x,y]=(0,a.useState)([]),[j,C]=(0,a.useState)(!0),[k,S]=(0,a.useState)(!1),[O,P,E]=(0,f.useEntityBlockEditor)("postType","obsidian_form",{id:t||0}),[N,B]=(0,f.useEntityProp)("postType","obsidian_form","title",t||0),[T,F]=(0,f.useEntityProp)("postType","obsidian_form","meta",t||0);(0,a.useEffect)((()=>{const e=m(),o=t?{...e,...T?._obsidian_form_settings||{}}:e;i({formSettings:o})}),[T?._obsidian_form_settings,t]);const I=(0,c.useBlockProps)({className:"obsidian-form__editor obsidian-form__editor--ready"}),$=(0,c.useInnerBlocksProps)({},{value:O,onInput:P,onChange:E,allowedBlocks:["obsidian-form/field-group"],renderAppender:O?.length?void 0:c.InnerBlocks.ButtonBlockAppender});(0,a.useEffect)((()=>{t||(C(!0),(async()=>{let e=1,o=[],i=1;for(;e<=i;)try{const t=await r()({path:`/wp/v2/obsidian_form?per_page=100&page=${e}`,parse:!1}),s=await t.json();if(!(s.length>0))break;o=o.concat(s),i=parseInt(t.headers.get("X-WP-TotalPages"),10),e++}catch(e){console.error("Error fetching forms:",e),(0,d.createNotice)("error",(0,l.__)("Error fetching forms. Please try again.","obsidian-forms"),{isDismissible:!0});break}return o})().then((e=>{if(0===e.length)S(!0);else{const o=e.map((e=>({label:`${e.title.rendered} (ID: ${e.id})`,value:e.id})));y(o),S(!1)}})).finally((()=>{C(!1)})))}),[t]);return t?(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(c.InspectorControls,{children:(0,p.jsx)(n.PanelBody,{header:"Obsidian Form Settings",children:(0,p.jsx)(b,{formSettings:s,handleSettingChange:(e,o)=>{if(!t||!s||!e)return;const i={...s,[e]:o};F({...T,_obsidian_form_settings:i})}})})}),(0,p.jsxs)("form",{...I,children:[(0,p.jsx)(c.RichText,{value:N,onChange:B,placeholder:(0,l.__)("Enter Form Title","obsidian-forms"),tagName:"h2"}),(0,p.jsx)("div",{className:"wp-block-obsidian-form-fields",children:(0,p.jsx)("div",{...$})})]})]}):(0,p.jsx)(n.Placeholder,{icon:"feedback",label:(0,l.__)("Obsidian Form","obsidian-forms"),className:"obsidian-forms-placeholder",instructions:k?(0,l.__)("Create a new form to get started!","obsidian-forms"):(0,l.__)("Create a new form or select an existing one.","obsidian-forms"),children:(0,p.jsxs)("div",{className:"obsidian-forms-choice",children:[(0,p.jsxs)("div",{className:"obsidian-forms-choice__form-creator",children:[(0,p.jsx)(n.TextControl,{placeholder:(0,l.__)("New form titleâ€¦","obsidian-forms"),value:g,onChange:_}),(0,p.jsx)(n.Button,{variant:"primary",onClick:async()=>{if(g.trim()){const e=await r()({path:"/wp/v2/obsidian_form",method:"POST",data:{title:g,content:'\x3c!-- wp:obsidian-form/field-group --\x3e\n\x3c!-- wp:obsidian-form/field {"isRequired":true} /--\x3e\n\x3c!-- /wp:obsidian-form/field-group --\x3e',status:"publish",meta:{_obsidian_form_settings:m()}}});e?.id?(i({formPostId:e.id}),h(!1)):(0,d.createNotice)("error",(0,l.__)("Error creating form. Please try again.","obsidian-forms"),{isDismissible:!0})}},disabled:!g.trim(),children:(0,l.__)("Create","obsidian-forms")})]}),!k&&(0,p.jsxs)("div",{className:"obsidian-forms-choice__form-selector",children:[(0,p.jsx)(n.ComboboxControl,{value:w,options:x,onChange:e=>v(e),shouldShowMenuOnFocus:!0,disabled:j}),(0,p.jsxs)("div",{className:"button-group",children:[(0,p.jsx)(n.Button,{variant:"primary",onClick:()=>{w&&i({formPostId:w})},disabled:!w||j,children:(0,l.__)("Select","obsidian-forms")}),(0,p.jsx)(n.Button,{className:"is-secondary",onClick:async()=>{if(w)try{const e=await r()({path:`/wp/v2/obsidian_form/${w}`});if(e?.id){const o=await r()({path:"/wp/v2/obsidian_form",method:"POST",data:{title:`${e.title.rendered} (Copy)`,content:e.raw_content,status:"publish",meta:{_obsidian_form_settings:e.meta?._obsidian_form_settings||m()}}});o?.id&&i({formPostId:o.id})}}catch(e){console.error("Error copying form:",e),(0,d.createNotice)("error",(0,l.__)("Error copying form. Please try again.","obsidian-forms"),{isDismissible:!0})}},disabled:!w||j,children:(0,l.__)("Copy","obsidian-forms")})]})]})]})})},save:()=>null})}},i={};function t(e){var s=i[e];if(void 0!==s)return s.exports;var r=i[e]={exports:{}};return o[e](r,r.exports,t),r.exports}t.m=o,e=[],t.O=(o,i,s,r)=>{if(!i){var n=1/0;for(c=0;c<e.length;c++){i=e[c][0],s=e[c][1],r=e[c][2];for(var a=!0,l=0;l<i.length;l++)(!1&r||n>=r)&&Object.keys(t.O).every((e=>t.O[e](i[l])))?i.splice(l--,1):(a=!1,r<n&&(n=r));if(a){e.splice(c--,1);var d=s();void 0!==d&&(o=d)}}return o}r=r||0;for(var c=e.length;c>0&&e[c-1][2]>r;c--)e[c]=e[c-1];e[c]=[i,s,r]},t.n=e=>{var o=e&&e.__esModule?()=>e.default:()=>e;return t.d(o,{a:o}),o},t.d=(e,o)=>{for(var i in o)t.o(o,i)&&!t.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:o[i]})},t.o=(e,o)=>Object.prototype.hasOwnProperty.call(e,o),(()=>{var e={884:0,36:0};t.O.j=o=>0===e[o];var o=(o,i)=>{var s,r,n=i[0],a=i[1],l=i[2],d=0;if(n.some((o=>0!==e[o]))){for(s in a)t.o(a,s)&&(t.m[s]=a[s]);if(l)var c=l(t)}for(o&&o(i);d<n.length;d++)r=n[d],t.o(e,r)&&e[r]&&e[r][0](),e[r]=0;return t.O(c)},i=self.webpackChunkobsidian_forms=self.webpackChunkobsidian_forms||[];i.forEach(o.bind(null,0)),i.push=o.bind(null,i.push.bind(i))})();var s=t.O(void 0,[36],(()=>t(258)));s=t.O(s)})();